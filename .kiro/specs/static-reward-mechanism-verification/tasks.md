# 静态奖励机制验证与显示修复实施计划

## 概述

本实施计划将全面验证静态奖励的 50% MC + 50% JBC 分配机制，确保合约实现正确且前端显示准确。通过系统性的测试和验证，保证用户能够清楚地看到奖励分配的详细信息。

## 任务

- [x] 1. 合约机制验证和测试
  - 验证 claimRewards 函数中的 50/50 分配逻辑
  - 测试价格计算的准确性
  - 验证事件触发和数据记录
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

- [ ]* 1.1 编写合约分配逻辑测试
  - **属性1**: 对于任何静态奖励总额，MC部分和JBC等值部分应该各占50%
  - **验证需求**: 1.1, 1.2

- [ ]* 1.2 编写价格计算准确性测试
  - **属性2**: 对于任何AMM池状态，JBC价格计算应该反映当前的储备比例
  - **验证需求**: 3.1, 3.2, 3.3

- [ ]* 1.3 编写事件数据一致性测试
  - **属性3**: 对于任何奖励发放，RewardClaimed事件中的数据应该与实际转账数量一致
  - **验证需求**: 6.1, 6.2

- [x] 2. 前端显示逻辑验证
  - 检查 EarningsDetail 组件的奖励解析逻辑
  - 验证 dailyStats 计算中的 MC/JBC 分别统计
  - 测试价格显示和实时更新功能
  - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ]* 2.1 验证前端事件解析逻辑
  - **属性4**: 对于任何RewardClaimed事件，前端解析的数据应该与事件原始数据完全一致
  - **验证需求**: 2.2, 6.3

- [ ]* 2.2 测试价格显示实时性
  - **属性6**: 对于任何储备量变化，前端显示的价格应该实时更新
  - **验证需求**: 3.5, 2.4

- [ ] 3. 创建奖励分配诊断工具
  - 创建脚本验证用户的静态奖励分配是否正确
  - 检查 MC/JBC 价格计算逻辑
  - 验证前端显示与合约数据的一致性
  - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ]* 3.1 编写余额处理测试
  - **属性5**: 对于任何合约余额不足的情况，系统应该记录实际转账数量而非预期数量
  - **验证需求**: 4.3, 4.4, 4.5

- [ ]* 3.2 创建数据一致性检查工具
  - 验证合约事件与前端显示数据的一致性
  - _需求: 6.3, 6.4, 6.5_

- [x] 4. 优化用户界面显示
  - 改进静态奖励的显示组件，明确显示 50% MC + 50% JBC
  - 添加当前 MC/JBC 汇率显示
  - 优化历史记录中的 MC/JBC 分别显示
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x]* 4.1 创建静态奖励显示组件
  - 设计清晰的 50/50 分配显示界面
  - _需求: 5.1, 5.2_

- [x]* 4.2 添加价格信息显示
  - 显示当前 MC/JBC 汇率和计算逻辑
  - _需求: 5.4_

- [x]* 4.3 优化历史记录显示
  - 分别显示 MC 和 JBC 的收益数量
  - _需求: 5.3_

- [ ] 5. 端到端流程测试
  - 测试完整的质押→领取→显示流程
  - 验证不同 AMM 池状态下的奖励分配
  - 测试边界情况和异常处理
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ]* 5.1 编写端到端测试用例
  - 测试完整的奖励领取和显示流程
  - _需求: 1.1, 1.2, 2.1, 2.2_

- [ ]* 5.2 测试边界情况处理
  - 测试零储备量、最小流动性等边界情况
  - _需求: 3.2, 3.3, 4.3, 4.4_

- [ ] 6. 性能和用户体验优化
  - 优化价格计算的性能
  - 改进数据加载和刷新机制
  - 添加加载状态和错误提示
  - _需求: 3.4, 3.5, 6.4, 6.5_

- [ ]* 6.1 优化价格计算性能
  - 缓存价格计算结果，减少重复计算
  - _需求: 3.4_

- [ ]* 6.2 改进错误处理和用户提示
  - 为价格计算异常、余额不足等情况添加友好提示
  - _需求: 6.4, 6.5_

- [ ] 7. 数据验证和修复工具
  - 创建管理员工具验证所有用户的奖励数据
  - 提供数据修复和重新计算功能
  - 添加数据一致性监控
  - _需求: 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 7.1 创建数据验证工具
  - 批量验证用户奖励数据的准确性
  - _需求: 6.1, 6.2_

- [ ]* 7.2 添加数据修复功能
  - 提供不一致数据的修复机制
  - _需求: 6.5_

- [ ] 8. 检查点 - 确保所有验证通过
  - 验证合约 50/50 分配机制正确工作
  - 确认前端正确显示 MC 和 JBC 分配
  - 验证价格计算和实时更新功能
  - 确保数据一致性和用户体验

- [ ] 9. 用户验收测试
  - 邀请用户测试新的显示界面
  - 验证用户能够清楚理解 50% MC + 50% JBC 机制
  - 收集反馈并进行最终优化
  - _需求: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ]* 9.1 用户界面测试
  - 测试用户对新界面的理解和使用体验
  - _需求: 5.1, 5.2, 5.5_

- [ ]* 9.2 机制理解验证
  - 确认用户能够正确理解 50/50 分配机制
  - _需求: 5.3, 5.4_

## 注意事项

- 任务标记 `*` 的为可选任务，可根据实际情况决定是否执行
- 重点关注合约逻辑验证和前端显示的准确性
- 确保所有测试覆盖边界情况和异常处理
- 优先验证核心的 50/50 分配机制是否正确工作
- 所有更改都应该保持向后兼容性