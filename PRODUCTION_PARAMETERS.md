# 🔧 生产环境参数配置

## 📊 当前问题分析

### 当前配置 (测试环境)
```solidity
uint256 public constant SECONDS_IN_UNIT = 60;  // 60秒 = 1分钟
```

**质押周期**:
- 7天质押 = 7分钟 (测试用)
- 15天质押 = 15分钟 (测试用)  
- 30天质押 = 30分钟 (测试用)

**收益率** (每分钟):
- 7天: 1.3333334% (每分钟)
- 15天: 1.6666667% (每分钟)
- 30天: 2.0% (每分钟)

### 生产环境配置 (需要修改)
```solidity
uint256 public constant SECONDS_IN_UNIT = 86400;  // 86400秒 = 1天
```

**质押周期**:
- 7天质押 = 7天 (真实天数)
- 15天质押 = 15天 (真实天数)
- 30天质押 = 30天 (真实天数)

**收益率** (每天):
- 7天: 1.3333334% (每天)
- 15天: 1.6666667% (每天)
- 30天: 2.0% (每天)

## 🔄 需要修改的参数

### 1. 智能合约参数

#### 主要修改
```solidity
// 从测试环境的分钟单位
uint256 public constant SECONDS_IN_UNIT = 60;

// 改为生产环境的天单位
uint256 public constant SECONDS_IN_UNIT = 86400;  // 24 * 60 * 60 = 86400秒
```

#### 收益率保持不变
```solidity
// 7天质押: 1.3333334% 每天 (总收益约9.33%)
if (stakes[i].cycleDays == 7) ratePerBillion = 13333334;

// 15天质押: 1.6666667% 每天 (总收益约25%)  
else if (stakes[i].cycleDays == 15) ratePerBillion = 16666667;

// 30天质押: 2.0% 每天 (总收益约60%)
else if (stakes[i].cycleDays == 30) ratePerBillion = 20000000;
```

### 2. 前端显示参数

#### 质押周期显示
```javascript
// 当前测试环境显示
const stakingPeriods = [
  { days: 7, label: "7分钟", rate: "1.33%" },
  { days: 15, label: "15分钟", rate: "1.67%" },
  { days: 30, label: "30分钟", rate: "2.00%" }
];

// 生产环境应显示
const stakingPeriods = [
  { days: 7, label: "7天", rate: "1.33%" },
  { days: 15, label: "15天", rate: "1.67%" },
  { days: 30, label: "30天", rate: "2.00%" }
];
```

#### 时间计算修改
```javascript
// 当前: 分钟计算
const timeRemaining = (stakeTime + stakeDays * 60) - currentTime;

// 生产环境: 天数计算  
const timeRemaining = (stakeTime + stakeDays * 86400) - currentTime;
```

### 3. 环境变量配置

#### .env.production 更新
```bash
# 质押相关配置
VITE_STAKING_UNIT_SECONDS=86400          # 1天 = 86400秒
VITE_STAKING_PERIODS="7,15,30"           # 支持的质押天数
VITE_STAKING_RATES="1.33,1.67,2.00"     # 对应的日收益率(%)

# 显示配置
VITE_TIME_UNIT="days"                    # 时间单位显示
VITE_RATE_UNIT="daily"                   # 收益率单位显示
```

## 📋 部署检查清单

### 合约部署前检查
- [ ] 确认 `SECONDS_IN_UNIT = 86400`
- [ ] 验证质押周期逻辑 (7/15/30天)
- [ ] 测试收益计算公式
- [ ] 确认时间戳计算正确

### 前端部署前检查  
- [ ] 更新质押周期显示文本
- [ ] 修改时间计算逻辑
- [ ] 更新收益率显示单位
- [ ] 测试倒计时功能

### 测试验证
- [ ] 部署到测试网验证
- [ ] 创建小额质押测试
- [ ] 验证收益计算准确性
- [ ] 确认到期时间正确

## 🔢 收益计算示例

### 生产环境收益计算

#### 7天质押 (1000 MC)
```
日收益率: 1.3333334%
每日收益: 1000 * 0.013333334 = 13.33 MC
7天总收益: 13.33 * 7 = 93.33 MC
总回报: 1000 + 93.33 = 1093.33 MC
```

#### 15天质押 (1000 MC)
```
日收益率: 1.6666667%  
每日收益: 1000 * 0.016666667 = 16.67 MC
15天总收益: 16.67 * 15 = 250 MC
总回报: 1000 + 250 = 1250 MC
```

#### 30天质押 (1000 MC)
```
日收益率: 2.0%
每日收益: 1000 * 0.02 = 20 MC  
30天总收益: 20 * 30 = 600 MC
总回报: 1000 + 600 = 1600 MC
```

## ⚠️ 重要注意事项

### 1. 合约升级
- 这是一个**重大参数变更**
- 需要通过**合约升级**或**重新部署**实现
- 建议在测试网充分测试后再部署主网

### 2. 用户影响
- 现有测试用户的质押会受到影响
- 建议在正式上线前清理测试数据
- 或者提供迁移方案

### 3. 前端兼容性
- 前端需要同步更新时间显示逻辑
- 确保新老版本的兼容性
- 提供用户友好的升级提示

### 4. 监控和验证
- 部署后密切监控收益计算
- 设置自动化测试验证
- 准备回滚方案

## 🚀 部署步骤

### 1. 合约修改
```bash
# 修改合约参数
vim contracts/JinbaoProtocolV2.sol
# 将 SECONDS_IN_UNIT 从 60 改为 86400
```

### 2. 前端修改
```bash
# 更新前端配置
vim .env.production
# 添加生产环境时间参数
```

### 3. 测试验证
```bash
# 编译和测试
npm run compile
npm run test:contracts

# 部署到测试网
npm run deploy:sepolia
```

### 4. 生产部署
```bash
# 部署到生产环境
npm run deploy:prod
```

---

**创建时间**: 2024-12-29  
**状态**: 待实施  
**优先级**: 高 (生产环境必须修改)