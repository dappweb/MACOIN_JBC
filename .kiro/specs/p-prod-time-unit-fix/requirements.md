# P-prod环境时间单位修复需求文档

## 介绍

本文档定义了将p-prod环境的时间单位从分钟级别修复为天级别的需求，以确保质押周期、奖励解锁和燃烧机制按照商业预期运行。

## 术语表

- **SECONDS_IN_UNIT**: 合约中的基础时间单位，影响所有时间相关计算
- **P-prod环境**: 生产预发布环境，应使用真实的投资周期
- **质押周期**: 用户流动性质押的持续时间（7天/15天/30天）
- **时间单位修复**: 将SECONDS_IN_UNIT从60秒改为86400秒
- **合约升级**: 通过UUPS代理模式升级合约实现

## 需求

### 需求1: 时间单位配置修复

**用户故事**: 作为p-prod环境用户，我希望质押周期按照真实天数计算，而不是分钟数，以便进行真实的投资决策。

#### 验收标准

1. WHEN 用户选择7天质押 THEN 实际质押时间应为7天而不是7分钟
2. WHEN 用户选择15天质押 THEN 实际质押时间应为15天而不是15分钟
3. WHEN 用户选择30天质押 THEN 实际质押时间应为30天而不是30分钟
4. WHEN 系统查询SECONDS_IN_UNIT THEN 应返回86400而不是60
5. WHEN 用户查看质押倒计时 THEN 应显示天/小时/分钟格式而不是分钟/秒格式

### 需求2: 动态奖励解锁时间修复

**用户故事**: 作为获得极差奖励的用户，我希望30天解锁期是真实的30天，而不是30分钟，以符合投资预期。

#### 验收标准

1. WHEN 用户获得极差奖励 THEN 解锁时间应为30天后而不是30分钟后
2. WHEN 用户查看动态奖励状态 THEN 待解锁奖励应显示剩余天数
3. WHEN 极差奖励到期 THEN 用户应能在30天后提取而不是30分钟后
4. WHEN 系统计算解锁时间 THEN 应使用86400秒作为基础单位
5. WHEN 用户查看奖励历史 THEN 解锁时间应显示正确的日期格式

### 需求3: 燃烧机制时间修复

**用户故事**: 作为协议参与者，我希望日燃烧机制按照真实的24小时周期执行，而不是分钟级别，以维护代币经济稳定性。

#### 验收标准

1. WHEN 系统执行日燃烧 THEN 应每24小时执行一次而不是每分钟
2. WHEN 用户查看燃烧历史 THEN 应显示每日燃烧记录而不是分钟级记录
3. WHEN 系统计算燃烧间隔 THEN 应使用86400秒作为基础单位
4. WHEN 燃烧机制触发 THEN 应基于真实的日周期而不是分钟周期
5. WHEN 用户查看下次燃烧时间 THEN 应显示小时级别的倒计时

### 需求4: 门票灵活期时间修复

**用户故事**: 作为购买门票的用户，我希望72小时的灵活期是真实的72小时，而不是72分钟，以便有足够时间决定质押策略。

#### 验收标准

1. WHEN 用户购买门票 THEN 灵活期应为72小时而不是72分钟
2. WHEN 用户在灵活期内 THEN 应有充足时间进行质押决策
3. WHEN 系统计算灵活期剩余时间 THEN 应显示小时和分钟格式
4. WHEN 灵活期即将到期 THEN 应提前合理时间提醒用户
5. WHEN 灵活期结束 THEN 门票状态应正确更新

### 需求5: 合约升级安全性

**用户故事**: 作为系统管理员，我希望时间单位修复过程中不会丢失任何用户数据，并且升级过程安全可靠。

#### 验收标准

1. WHEN 执行合约升级 THEN 所有用户数据应完整保留
2. WHEN 升级完成后 THEN 现有质押记录应按新时间单位重新计算
3. WHEN 升级过程中 THEN 应有完整的备份和回滚机制
4. WHEN 升级失败时 THEN 应能安全回滚到原始状态
5. WHEN 升级完成后 THEN 应进行全面的功能验证测试

### 需求6: 用户通知和过渡

**用户故事**: 作为现有用户，我希望在时间单位修复前后得到充分的通知和说明，了解对我现有投资的影响。

#### 验收标准

1. WHEN 升级前 THEN 应通知所有用户即将进行的时间单位修复
2. WHEN 升级完成后 THEN 应通知用户新的时间计算方式
3. WHEN 用户查询现有质押 THEN 应显示按新时间单位调整后的到期时间
4. WHEN 用户有疑问时 THEN 应提供详细的FAQ和帮助文档
5. WHEN 用户受到影响时 THEN 应提供合理的补偿或调整方案

### 需求7: 前端界面适配

**用户故事**: 作为用户，我希望前端界面能正确显示修复后的时间信息，包括倒计时、历史记录和状态提示。

#### 验收标准

1. WHEN 用户查看质押倒计时 THEN 应显示天/小时/分钟格式
2. WHEN 用户查看奖励解锁时间 THEN 应显示准确的剩余天数
3. WHEN 用户查看历史记录 THEN 时间戳应显示正确的日期时间
4. WHEN 用户进行新操作 THEN 预期时间应基于天级别计算
5. WHEN 系统显示时间相关信息 THEN 应与实际合约行为一致

### 需求8: 环境一致性验证

**用户故事**: 作为开发者，我希望修复后的p-prod环境与预期的生产环境配置一致，并与test环境形成合理的差异化。

#### 验收标准

1. WHEN 对比p-prod和预期配置 THEN SECONDS_IN_UNIT应为86400秒
2. WHEN 对比test和p-prod环境 THEN 应形成分钟级vs天级的合理差异
3. WHEN 验证环境配置 THEN 所有时间相关参数应符合商业预期
4. WHEN 运行环境对比脚本 THEN 应显示修复后的正确配置
5. WHEN 进行功能测试 THEN 所有时间相关功能应按天级别运行

### 需求9: 完整四种奖励机制实现

**用户故事**: 作为协议用户，我希望V4合约实现完整的四种奖励机制，包括静态奖励、动态奖励、燃烧奖励和交易奖励，以获得完整的投资收益体验。

#### 验收标准

1. WHEN 用户质押挖矿 THEN 应获得双币静态奖励 (50% MC + 50% JBC通过兑换池兑换)
2. WHEN 用户推荐他人 THEN 应获得动态奖励 (直推25% + 层级1% + 级差V0-V9)
3. WHEN 系统执行日燃烧 THEN 应纯销毁JBC代币而不分红给用户
4. WHEN 用户使用AMM兑换 THEN 应基于销毁价值获得交易奖励分红
5. WHEN 查询奖励类型 THEN 应能区分四种不同的奖励机制

### 需求10: 双币奖励机制正确实现

**用户故事**: 作为获得静态和级差奖励的用户，我希望奖励按照50% MC直接获得 + 50% MC在兑换池兑换成JBC的方式分发，而不是直接分发JBC。

#### 验收标准

1. WHEN 用户获得静态奖励 THEN 50%应为MC代币，50%应通过兑换池兑换成JBC
2. WHEN 用户获得级差奖励 THEN 50%应为MC代币，50%应通过兑换池兑换成JBC
3. WHEN 系统分发JBC奖励 THEN 应通过内置兑换池自动兑换而非直接分发
4. WHEN 用户获得动态奖励 THEN 应为100% MC代币，无JBC部分
5. WHEN 用户获得层级奖励 THEN 应为100% MC代币，无JBC部分

### 需求11: 燃烧机制纯销毁实现

**用户故事**: 作为协议参与者，我希望JBC燃烧机制是纯销毁而不分红给用户，以创造真正的通缩效应。

#### 验收标准

1. WHEN 系统执行日燃烧 THEN 应将JBC转移到黑洞地址而非分配给用户
2. WHEN 燃烧完成后 THEN 燃烧的JBC应永久从流通中移除
3. WHEN 用户查询燃烧奖励 THEN 应显示无燃烧分红奖励
4. WHEN 燃烧事件触发 THEN 应记录0参与者，因为不分红
5. WHEN 计算通缩效应 THEN 应基于纯销毁而非分红机制

### 需求12: AMM滑点手续费纯销毁实现

**用户故事**: 作为使用内置AMM的用户，我希望滑点手续费被纯销毁而不分发给用户，以创造通缩效应支撑代币价值。

#### 验收标准

1. WHEN 用户MC→JBC兑换 THEN 应销毁25%的MC且不分发给任何用户
2. WHEN 用户JBC→MC兑换 THEN 应销毁50%的JBC且不分发给任何用户
3. WHEN 销毁完成后 THEN 销毁的代币应永久从流通中移除
4. WHEN 用户查询交易奖励 THEN 应显示无AMM手续费分红
5. WHEN 计算通缩效应 THEN 应基于纯销毁机制而非分红机制

### 需求13: V等级系统完整实现

**用户故事**: 作为团队领导者，我希望V等级系统(V0-V9)能正确计算级差奖励，并支持双币奖励分发。

#### 验收标准

1. WHEN 用户团队达到10人 THEN 应升级到V1等级(5%极差收益)
2. WHEN 用户团队达到100人 THEN 应升级到V3等级(15%极差收益)
3. WHEN 用户团队达到1000人 THEN 应升级到V5等级(25%极差收益)
4. WHEN 计算级差奖励 THEN 应基于等级差额计算奖励金额
5. WHEN 分发级差奖励 THEN 应使用双币机制且30天后解锁