# çº§å·®å¥–åŠ±æœ€æ–°æœºåˆ¶è¯´æ˜ - 50% MC + 50% JBC åˆ†é…

## ğŸ”„ **æœºåˆ¶æ›´æ–°æ¦‚è¿°**

æ ¹æ®æœ€æ–°çš„åè®®å‡çº§ï¼Œçº§å·®å¥–åŠ±ç°åœ¨ä¹Ÿé‡‡ç”¨äº†ä¸é™æ€å¥–åŠ±ç›¸åŒçš„ **50% MC + 50% JBC** åˆ†é…æœºåˆ¶ï¼Œè¿›ä¸€æ­¥å®Œå–„äº†åŒä»£å¸ç»æµæ¨¡å‹ã€‚

## ğŸ“Š **æ–°æ—§æœºåˆ¶å¯¹æ¯”**

### **æ—§æœºåˆ¶ (ä»… MC åˆ†é…)**
```
çº§å·®å¥–åŠ± = 100% MC
ç”¨æˆ·è·å¾—: 100 MC
```

### **æ–°æœºåˆ¶ (50/50 åˆ†é…)**
```
çº§å·®å¥–åŠ±æ€»é¢ = 50% MC + 50% JBC (ç­‰å€¼)
â”œâ”€ MC éƒ¨åˆ†: 50% ç›´æ¥åˆ†å‘
â””â”€ JBC éƒ¨åˆ†: 50% æŒ‰å½“å‰æ±‡ç‡è½¬æ¢ä¸º JBC æ•°é‡
```

## ğŸ§® **æ–°åˆ†é…å…¬å¼**

### **åŸºç¡€è®¡ç®—**
```
çº§å·®å¥–åŠ±æ€»é¢ = min(è´¨æŠ¼é‡‘é¢, ä¸Šçº§é—¨ç¥¨é‡‘é¢) Ã— (ä¸Šçº§ç­‰çº§æ¯”ä¾‹ - å½“å‰æœ€é«˜æ¯”ä¾‹)

MC éƒ¨åˆ† = çº§å·®å¥–åŠ±æ€»é¢ Ã· 2
JBC ä»·å€¼éƒ¨åˆ† = çº§å·®å¥–åŠ±æ€»é¢ Ã· 2
JBC æ•°é‡ = JBC ä»·å€¼éƒ¨åˆ† Ã· å½“å‰ JBC ä»·æ ¼
```

### **JBC ä»·æ ¼è®¡ç®—**
```
JBC ä»·æ ¼ = swapReserveMC Ã— 1e18 Ã· swapReserveJBC
```

## ğŸ’¡ **è¯¦ç»†æ¡ˆä¾‹è¯´æ˜**

### **æ¡ˆä¾‹1: åŸºç¡€ 50/50 çº§å·®åˆ†é…**

#### **ç½‘ç»œç»“æ„**
```
ç‹æ€»ç›‘ (V7, 35%) - é—¨ç¥¨: 1000 MC
â””â”€â”€ æç»ç† (V5, 25%) - é—¨ç¥¨: 1000 MC  
    â””â”€â”€ å¼ æ€» (V2, 10%) - é—¨ç¥¨: 1000 MC
        â””â”€â”€ å°æ˜ (V0, 0%) - è´¨æŠ¼: 600 MC
```

#### **å½“å‰å¸‚åœºçŠ¶æ€**
```
AMM æ± çŠ¶æ€:
- MC å‚¨å¤‡: 50,000 MC
- JBC å‚¨å¤‡: 200,000 JBC
- JBC ä»·æ ¼: 50,000 Ã— 1e18 Ã· 200,000 = 0.25 MC/JBC
```

#### **çº§å·®è®¡ç®—è¿‡ç¨‹**

##### **å¼ æ€» (V2) è·å¾—çº§å·®**
```
çº§å·®æ€»é¢: 600 Ã— (10% - 0%) = 60 MC

50/50 åˆ†é…:
â”œâ”€ MC éƒ¨åˆ†: 60 Ã· 2 = 30 MC
â””â”€ JBC éƒ¨åˆ†: 30 Ã· 0.25 = 120 JBC

å¼ æ€»å®é™…è·å¾—: 30 MC + 120 JBC
```

##### **æç»ç† (V5) è·å¾—çº§å·®**
```
çº§å·®æ€»é¢: 600 Ã— (25% - 10%) = 90 MC

50/50 åˆ†é…:
â”œâ”€ MC éƒ¨åˆ†: 90 Ã· 2 = 45 MC
â””â”€ JBC éƒ¨åˆ†: 45 Ã· 0.25 = 180 JBC

æç»ç†å®é™…è·å¾—: 45 MC + 180 JBC
```

##### **ç‹æ€»ç›‘ (V7) è·å¾—çº§å·®**
```
çº§å·®æ€»é¢: 600 Ã— (35% - 25%) = 60 MC

50/50 åˆ†é…:
â”œâ”€ MC éƒ¨åˆ†: 60 Ã· 2 = 30 MC
â””â”€ JBC éƒ¨åˆ†: 30 Ã· 0.25 = 120 JBC

ç‹æ€»ç›‘å®é™…è·å¾—: 30 MC + 120 JBC
```

#### **æ€»åˆ†é…ç»“æœ**
| ç”¨æˆ· | çº§å·®æ€»é¢ | MC è·å¾— | JBC è·å¾— | æ€»ä»·å€¼ |
|------|---------|---------|---------|--------|
| å¼ æ€» | 60 MC | 30 MC | 120 JBC | 60 MC |
| æç»ç† | 90 MC | 45 MC | 180 JBC | 90 MC |
| ç‹æ€»ç›‘ | 60 MC | 30 MC | 120 JBC | 60 MC |
| **æ€»è®¡** | **210 MC** | **105 MC** | **420 JBC** | **210 MC** |

---

### **æ¡ˆä¾‹2: ä¸åŒä»·æ ¼ä¸‹çš„åˆ†é…**

#### **åœºæ™¯A: JBC ä»·æ ¼è¾ƒé«˜ (0.5 MC/JBC)**
```
AMM æ± çŠ¶æ€:
- MC å‚¨å¤‡: 100,000 MC  
- JBC å‚¨å¤‡: 200,000 JBC
- JBC ä»·æ ¼: 0.5 MC/JBC

å¼ æ€»çº§å·® 60 MC:
â”œâ”€ MC éƒ¨åˆ†: 30 MC
â””â”€ JBC éƒ¨åˆ†: 30 Ã· 0.5 = 60 JBC
```

#### **åœºæ™¯B: JBC ä»·æ ¼è¾ƒä½ (0.1 MC/JBC)**
```
AMM æ± çŠ¶æ€:
- MC å‚¨å¤‡: 20,000 MC
- JBC å‚¨å¤‡: 200,000 JBC  
- JBC ä»·æ ¼: 0.1 MC/JBC

å¼ æ€»çº§å·® 60 MC:
â”œâ”€ MC éƒ¨åˆ†: 30 MC
â””â”€ JBC éƒ¨åˆ†: 30 Ã· 0.1 = 300 JBC
```

#### **ä»·æ ¼å½±å“å¯¹æ¯”**
| JBC ä»·æ ¼ | MC è·å¾— | JBC è·å¾— | è¯´æ˜ |
|----------|---------|---------|------|
| 0.5 MC | 30 MC | 60 JBC | ä»·æ ¼é«˜ï¼ŒJBC æ•°é‡å°‘ |
| 0.25 MC | 30 MC | 120 JBC | ä¸­ç­‰ä»·æ ¼ |
| 0.1 MC | 30 MC | 300 JBC | ä»·æ ¼ä½ï¼ŒJBC æ•°é‡å¤š |

> **å…³é”®æ´å¯Ÿ**: JBC ä»·æ ¼è¶Šä½ï¼Œç”¨æˆ·è·å¾—çš„ JBC æ•°é‡è¶Šå¤šï¼Œä½†æ€»ä»·å€¼ä¿æŒä¸å˜ã€‚

---

### **æ¡ˆä¾‹3: é—¨ç¥¨é™åˆ¶ä¸‹çš„ 50/50 åˆ†é…**

#### **åœºæ™¯è®¾å®š**
```
ç‹æ€»ç›‘ (V7, 35%) - é—¨ç¥¨: 1500 MC
â””â”€â”€ æç»ç† (V5, 25%) - é—¨ç¥¨: 300 MC âš ï¸ é—¨ç¥¨ä¸è¶³
    â””â”€â”€ å¼ æ€» (V2, 10%) - é—¨ç¥¨: 1000 MC
        â””â”€â”€ å°æ˜è´¨æŠ¼: 800 MC

JBC ä»·æ ¼: 0.25 MC/JBC
```

#### **çº§å·®è®¡ç®—**

##### **å¼ æ€» (æ­£å¸¸)**
```
çº§å·®æ€»é¢: min(800, 1000) Ã— 10% = 80 MC
â”œâ”€ MC éƒ¨åˆ†: 40 MC
â””â”€ JBC éƒ¨åˆ†: 40 Ã· 0.25 = 160 JBC
```

##### **æç»ç† (å—é—¨ç¥¨é™åˆ¶)**
```
çº§å·®æ€»é¢: min(800, 300) Ã— 15% = 45 MC âš ï¸
â”œâ”€ MC éƒ¨åˆ†: 22.5 MC
â””â”€ JBC éƒ¨åˆ†: 22.5 Ã· 0.25 = 90 JBC
```

##### **ç‹æ€»ç›‘ (æ­£å¸¸)**
```
çº§å·®æ€»é¢: min(800, 1500) Ã— 10% = 80 MC
â”œâ”€ MC éƒ¨åˆ†: 40 MC
â””â”€ JBC éƒ¨åˆ†: 40 Ã· 0.25 = 160 JBC
```

#### **é—¨ç¥¨é™åˆ¶å½±å“**
| ç”¨æˆ· | é—¨ç¥¨é‡‘é¢ | çº§å·®æ€»é¢ | MC è·å¾— | JBC è·å¾— |
|------|---------|---------|---------|---------|
| å¼ æ€» | 1000 MC | 80 MC | 40 MC | 160 JBC |
| æç»ç† | 300 MC | 45 MC | 22.5 MC | 90 JBC |
| ç‹æ€»ç›‘ | 1500 MC | 80 MC | 40 MC | 160 JBC |

---

## â° **æ—¶é—´æœºåˆ¶æ›´æ–°**

### **è®¡ç®—æ—¶æœº (ä¸å˜)**
```
è´¨æŠ¼æ—¶: ç«‹å³è®¡ç®—çº§å·®æ€»é¢å¹¶å­˜å‚¨
äº‹ä»¶: DifferentialRewardRecorded(stakeId, upline, totalAmount)
```

### **é‡Šæ”¾æ—¶æœº (æ–°å¢ 50/50 åˆ†é…)**
```
è´¨æŠ¼åˆ°æœŸ/é€€å‡ºæ—¶:
1. è·å–å­˜å‚¨çš„çº§å·®æ€»é¢
2. è®¡ç®—å½“å‰ JBC ä»·æ ¼
3. æ‰§è¡Œ 50/50 åˆ†é…
4. åˆ†åˆ«è½¬è´¦ MC å’Œ JBC
5. è§¦å‘äº‹ä»¶

æ–°äº‹ä»¶:
- DifferentialRewardReleased(stakeId, upline, mcAmount, jbcAmount)
- ReferralRewardPaid(user, from, mcAmount, jbcAmount, REWARD_DIFFERENTIAL)
```

### **ä»·æ ¼æ—¶ç‚¹**
```
é‡è¦: JBC ä»·æ ¼ä»¥é‡Šæ”¾æ—¶çš„å®æ—¶ä»·æ ¼ä¸ºå‡†ï¼Œè€Œéè®¡ç®—æ—¶çš„ä»·æ ¼
è¿™æ„å‘³ç€:
- è®¡ç®—æ—¶å­˜å‚¨æ€»é¢ (MC ç­‰å€¼)
- é‡Šæ”¾æ—¶æŒ‰å½“å‰ä»·æ ¼åˆ†é… JBC æ•°é‡
- ç”¨æˆ·æ‰¿æ‹…ä»·æ ¼æ³¢åŠ¨é£é™©/æ”¶ç›Š
```

---

## ğŸ”’ **å®‰å…¨æœºåˆ¶æ›´æ–°**

### **ä½™é¢æ£€æŸ¥**
```solidity
// MC ä½™é¢æ£€æŸ¥
if (mcToken.balanceOf(address(this)) >= mcPart && mcPart > 0) {
    mcToken.transfer(user, mcPart);
    mcTransferred = mcPart;
}

// JBC ä½™é¢æ£€æŸ¥  
if (jbcToken.balanceOf(address(this)) >= jbcAmount && jbcAmount > 0) {
    jbcToken.transfer(user, jbcAmount);
    jbcTransferred = jbcAmount;
}
```

### **ä»·æ ¼å¼‚å¸¸å¤„ç†**
```solidity
// æµåŠ¨æ€§ä¸è¶³æ—¶çš„å¤„ç†
uint256 jbcPrice = swapReserveJBC == 0 || swapReserveMC < MIN_LIQUIDITY 
    ? 1 ether  // é»˜è®¤ 1:1 æ¯”ä¾‹
    : (swapReserveMC * 1e18) / swapReserveJBC;
```

### **éƒ¨åˆ†è½¬è´¦å¤„ç†**
```
å¦‚æœåˆçº¦ä½™é¢ä¸è¶³:
- MC ä¸è¶³: åªè½¬è´¦å¯ç”¨çš„ MCï¼ŒJBC æ­£å¸¸è½¬è´¦
- JBC ä¸è¶³: åªè½¬è´¦å¯ç”¨çš„ JBCï¼ŒMC æ­£å¸¸è½¬è´¦
- éƒ½ä¸è¶³: æŒ‰å¯ç”¨ä½™é¢æ¯”ä¾‹åˆ†é…
```

---

## ğŸ“ˆ **ç»æµå½±å“åˆ†æ**

### **å¯¹ç”¨æˆ·çš„å½±å“**

#### **æ­£é¢å½±å“**
1. **å¤šæ ·åŒ–æ”¶ç›Š**: åŒæ—¶è·å¾— MC å’Œ JBCï¼Œåˆ†æ•£é£é™©
2. **ä»·æ ¼å¥—åˆ©**: JBC ä»·æ ¼ä½æ—¶è·å¾—æ›´å¤š JBC
3. **é•¿æœŸæŒæœ‰**: é¼“åŠ±æŒæœ‰ JBCï¼Œæ”¯æŒä»·æ ¼ç¨³å®š

#### **é£é™©è€ƒè™‘**
1. **ä»·æ ¼æ³¢åŠ¨**: JBC æ•°é‡å–å†³äºé‡Šæ”¾æ—¶ä»·æ ¼
2. **æµåŠ¨æ€§é£é™©**: éœ€è¦è¶³å¤Ÿçš„ AMM æµåŠ¨æ€§
3. **æ—¶é—´å·®å¼‚**: è®¡ç®—æ—¶å’Œé‡Šæ”¾æ—¶çš„ä»·æ ¼å·®å¼‚

### **å¯¹ç”Ÿæ€çš„å½±å“**

#### **ç§¯æä½œç”¨**
1. **JBC éœ€æ±‚**: å¢åŠ  JBC çš„å®é™…ä½¿ç”¨åœºæ™¯
2. **ä»·æ ¼æ”¯æ’‘**: æŒç»­çš„ JBC åˆ†å‘æ”¯æŒä»·æ ¼å‘ç°
3. **æµåŠ¨æ€§æ¿€åŠ±**: é¼“åŠ±ç”¨æˆ·æä¾› AMM æµåŠ¨æ€§

#### **å¹³è¡¡æœºåˆ¶**
1. **ä¾›éœ€å¹³è¡¡**: é€šè¿‡åˆ†é…æ¯”ä¾‹è°ƒèŠ‚ JBC ä¾›åº”
2. **ä»·æ ¼ç¨³å®š**: 50/50 åˆ†é…é¿å…å•ä¸€ä»£å¸å‹åŠ›
3. **ç”Ÿæ€å¾ªç¯**: MC å’Œ JBC çš„è‰¯æ€§å¾ªç¯

---

## ğŸ”§ **æŠ€æœ¯å®ç°è¦ç‚¹**

### **æ ¸å¿ƒå‡½æ•°æ›´æ–°**
```solidity
function _distributeReward(address user, uint256 amount, uint8 rType) internal returns (uint256, uint256) {
    // æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    UserInfo storage u = userInfo[user];
    Ticket storage t = userTicket[user];
    
    if (!u.isActive || t.exited || t.amount == 0) {
        return (0, 0);
    }
    
    // åº”ç”¨æ”¶ç›Šä¸Šé™
    uint256 available = u.currentCap - u.totalRevenue;
    uint256 payout = amount > available ? available : amount;
    
    if (payout == 0) return (0, 0);
    
    // 50/50 åˆ†é…
    uint256 mcPart = payout / 2;
    uint256 jbcValuePart = payout / 2;
    
    // è®¡ç®— JBC æ•°é‡
    uint256 jbcPrice = swapReserveJBC == 0 || swapReserveMC < MIN_LIQUIDITY 
        ? 1 ether 
        : (swapReserveMC * 1e18) / swapReserveJBC;
    uint256 jbcAmount = (jbcValuePart * 1e18) / jbcPrice;
    
    // è½¬è´¦
    uint256 mcTransferred = 0;
    uint256 jbcTransferred = 0;
    
    if (mcToken.balanceOf(address(this)) >= mcPart && mcPart > 0) {
        mcToken.transfer(user, mcPart);
        mcTransferred = mcPart;
    }
    
    if (jbcToken.balanceOf(address(this)) >= jbcAmount && jbcAmount > 0) {
        jbcToken.transfer(user, jbcAmount);
        jbcTransferred = jbcAmount;
    }
    
    // æ›´æ–°ç”¨æˆ·æ•°æ®
    u.totalRevenue += payout;
    
    // è§¦å‘äº‹ä»¶
    emit RewardPaid(user, payout, rType);
    
    return (mcTransferred, jbcTransferred);
}
```

### **äº‹ä»¶æ›´æ–°**
```solidity
event DifferentialRewardReleased(
    uint256 indexed stakeId, 
    address indexed upline, 
    uint256 mcAmount, 
    uint256 jbcAmount
);

event ReferralRewardPaid(
    address indexed user, 
    address indexed from, 
    uint256 mcAmount, 
    uint256 jbcAmount, 
    uint8 rewardType, 
    uint256 ticketId
);
```

---

## ğŸ¯ **ç”¨æˆ·ç­–ç•¥æ›´æ–°**

### **å¯¹çº§å·®è·å¾—è€…**
1. **æ—¶æœºé€‰æ‹©**: å…³æ³¨ JBC ä»·æ ¼ï¼Œåœ¨ä½ä»·æ—¶é‡Šæ”¾è·å¾—æ›´å¤š JBC
2. **æµåŠ¨æ€§ç›‘æ§**: ç¡®ä¿ AMM æ± æœ‰è¶³å¤ŸæµåŠ¨æ€§
3. **é•¿æœŸè§„åˆ’**: è€ƒè™‘ JBC çš„é•¿æœŸä»·å€¼æ½œåŠ›

### **å¯¹è´¨æŠ¼è€…**
1. **é‡Šæ”¾æ—¶æœº**: å¯ä»¥é€‰æ‹©åœ¨ JBC ä»·æ ¼è¾ƒä½æ—¶é€€å‡ºï¼Œè®©ä¸Šçº§è·å¾—æ›´å¤š JBC
2. **å¸‚åœºè§‚å¯Ÿ**: äº†è§£ JBC ä»·æ ¼è¶‹åŠ¿ï¼Œä¼˜åŒ–è´¨æŠ¼ç­–ç•¥

### **å¯¹ç”Ÿæ€å‚ä¸è€…**
1. **æµåŠ¨æ€§æä¾›**: ä¸º AMM æ± æä¾›æµåŠ¨æ€§ï¼Œè·å¾—æ‰‹ç»­è´¹æ”¶ç›Š
2. **å¥—åˆ©æœºä¼š**: åˆ©ç”¨ä»·æ ¼å·®å¼‚è¿›è¡Œå¥—åˆ©äº¤æ˜“
3. **é•¿æœŸæŒæœ‰**: æŒæœ‰ JBC å‚ä¸ç”Ÿæ€å‘å±•

---

## ğŸ‰ **æ€»ç»“**

çº§å·®å¥–åŠ±çš„ 50% MC + 50% JBC åˆ†é…æœºåˆ¶æ˜¯åè®®çš„é‡è¦å‡çº§ï¼š

### **æ ¸å¿ƒä¼˜åŠ¿**
1. **ç»Ÿä¸€æœºåˆ¶**: ä¸é™æ€å¥–åŠ±ä¿æŒä¸€è‡´çš„åˆ†é…æ–¹å¼
2. **åŒä»£å¸å¹³è¡¡**: ä¿ƒè¿› MC å’Œ JBC çš„å‡è¡¡å‘å±•
3. **ä»·æ ¼å‘ç°**: é€šè¿‡å®é™…ä½¿ç”¨ä¿ƒè¿› JBC ä»·æ ¼å‘ç°
4. **ç”Ÿæ€å®Œå–„**: æ„å»ºæ›´å®Œæ•´çš„åŒä»£å¸ç»æµæ¨¡å‹

### **å…³é”®ç‰¹ç‚¹**
1. **å®æ—¶ä»·æ ¼**: åŸºäºé‡Šæ”¾æ—¶çš„ JBC ä»·æ ¼è®¡ç®—
2. **é£é™©å…±æ‹…**: ç”¨æˆ·æ‰¿æ‹…ä»·æ ¼æ³¢åŠ¨çš„é£é™©å’Œæ”¶ç›Š
3. **æµåŠ¨æ€§ä¾èµ–**: éœ€è¦å……è¶³çš„ AMM æµåŠ¨æ€§æ”¯æŒ
4. **å®‰å…¨ä¿éšœ**: å¤šé‡æ£€æŸ¥ç¡®ä¿åˆ†é…å®‰å…¨

è¿™ä¸€æœºåˆ¶å‡çº§è¿›ä¸€æ­¥å®Œå–„äº† Jinbao Protocol çš„ç»æµæ¨¡å‹ï¼Œä¸ºç”¨æˆ·æä¾›äº†æ›´å¤šæ ·åŒ–çš„æ”¶ç›Šæ–¹å¼ï¼ŒåŒæ—¶ä¿ƒè¿›äº†æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿçš„å¥åº·å‘å±•ï¼

---

*æ–‡æ¡£æ›´æ–°æ—¶é—´: ${new Date().toLocaleString()}*  
*æœºåˆ¶ç‰ˆæœ¬: çº§å·®å¥–åŠ± 2.0 (50% MC + 50% JBC)*  
*é€‚ç”¨åˆçº¦: JinbaoProtocol.sol (å‡çº§ç‰ˆ)*