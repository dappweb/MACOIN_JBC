# 前端更新指南

## 📋 更新内容

### 1. 合约地址更新 ✅

**文件**: `src/Web3Context.tsx`

**更新内容**:
```typescript
// 旧地址
PROTOCOL: "0x77601aC473dB1195A1A9c82229C9bD008a69987A"

// 新地址
PROTOCOL: "0x0897Cee05E43B2eCf331cd80f881c211eb86844E"
```

**状态**: ✅ 已更新

---

## 🔍 其他需要检查的地方

### 1. 环境变量配置

如果使用了环境变量来配置合约地址，需要更新：

**`.env` 文件** (如果存在):
```bash
VITE_PROTOCOL_CONTRACT_ADDRESS=0x0897Cee05E43B2eCf331cd80f881c211eb86844E
```

### 2. 配置文件

检查以下配置文件是否需要更新：
- `src/config/production.ts`
- `src/config/test.ts`

### 3. 硬编码地址

检查是否有硬编码的合约地址：
- 组件文件
- 工具文件
- 配置文件

---

## ✅ 更新后的验证

### 1. 功能测试

更新后需要测试以下功能：
- ✅ 连接钱包
- ✅ 绑定推荐人
- ✅ 购买门票
- ✅ 质押流动性
- ✅ 领取奖励
- ✅ 赎回质押
- ✅ MC 换 JBC
- ✅ JBC 换 MC

### 2. 数据验证

- ✅ 用户数据是否正确显示
- ✅ 推荐关系是否正确
- ✅ 余额是否正确

---

## 📊 更新前后对比

### 旧合约
- **地址**: `0x77601aC473dB1195A1A9c82229C9bD008a69987A`
- **Owner**: JBC Token 合约 (无法直接管理)
- **状态**: 已弃用

### 新合约
- **地址**: `0x0897Cee05E43B2eCf331cd80f881c211eb86844E`
- **Owner**: JBC Token Owner (`0x4C10831CBcF9884ba72051b5287b6c87E4F74A48`)
- **状态**: 已部署并配置完成
- **用户数据**: 推荐关系已迁移 (365/367 用户)

---

## ⚠️ 重要注意事项

### 1. 用户授权

用户可能需要重新授权新合约使用 JBC Token：
- 如果用户之前授权过旧合约，需要重新授权新合约
- 前端应该提示用户重新授权

### 2. 数据迁移状态

- ✅ **推荐关系**: 已迁移 (365/367 用户)
- ⚠️ **其他数据**: 会在用户操作时自动恢复
  - `activeDirects`: 会在用户购买门票时自动更新
  - `teamCount`: 会在推荐关系链中自动计算
  - `totalRevenue`: 会在用户领取奖励时累积

### 3. 余额状态

- ⚠️ 新合约从零开始（需要重新注入流动性）
- ⚠️ 旧合约中的余额无法提取（约 34,802 MC + 1,000,001 JBC）

---

## 🔄 更新步骤

1. ✅ **更新合约地址** (`src/Web3Context.tsx`)
2. ⏳ **更新 JBC Token 的 protocolAddress** (需要 JBC Token Owner 调用)
3. ⏳ **重新注入流动性** (如果需要)
4. ⏳ **测试所有功能**
5. ⏳ **通知用户**

---

## 📝 更新检查清单

- [x] 更新 `src/Web3Context.tsx` 中的合约地址
- [ ] 检查环境变量配置
- [ ] 检查配置文件
- [ ] 检查硬编码地址
- [ ] 测试所有功能
- [ ] 更新 JBC Token 的 `protocolAddress`
- [ ] 通知用户

---

## 🚀 部署后操作

### 1. 更新 JBC Token 的 protocolAddress

需要 JBC Token Owner 调用：
```solidity
jbcToken.setProtocol(0x0897Cee05E43B2eCf331cd80f881c211eb86844E)
```

### 2. 重新注入流动性（如果需要）

如果需要交换功能，需要添加流动性：
```solidity
protocol.addLiquidity(jbcAmount) // 发送 MC 作为 value
```

### 3. 通知用户

- 通知用户新合约地址
- 提示用户可能需要重新授权
- 说明数据迁移状态

