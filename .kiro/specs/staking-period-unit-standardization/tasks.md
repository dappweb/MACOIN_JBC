# 实施计划: 流动性质押周期单位标准化

## 概述

本实施计划将系统地修复Jinbao Protocol中流动性质押周期单位显示错误的问题。我们将从配置文件修复开始，然后更新前端组件，最后添加验证和测试。每个任务都专注于特定的代码修改，确保用户看到正确的"天"而不是错误的"分钟"显示。

## 任务

- [x] 1. 修复核心配置文件
  - 更新生产环境配置文件中的时间单位设置
  - 修正质押周期标签从"分钟"改为"天"
  - 确保所有时间相关配置使用正确的天数单位
  - _需求: 2.1, 2.2_

- [ ] 2. 实施配置验证机制
  - [ ] 2.1 创建配置验证类和接口
    - 实现ConfigValidator类用于验证时间单位配置
    - 添加生产环境合规性检查
    - _需求: 2.3, 2.4_

  - [ ]* 2.2 编写配置验证的属性测试
    - **属性 3: 配置验证完整性**
    - **验证需求: Requirements 2.1, 2.3**

- [ ] 3. 修复前端时间显示组件
  - [ ] 3.1 更新质押周期选择器组件
    - 修复MiningPanel.tsx中的质押周期显示
    - 确保使用正确的天数标签
    - _需求: 1.1, 1.2_

  - [ ] 3.2 实施统一时间格式化工具
    - 创建TimeFormatter类处理所有时间显示
    - 实现SafeTimeFormatter提供错误降级方案
    - _需求: 1.3, 3.2_

  - [ ]* 3.3 编写时间格式化的属性测试
    - **属性 2: 时间格式化正确性**
    - **验证需求: Requirements 1.3, 3.2**

- [ ] 4. 更新所有相关UI组件
  - [ ] 4.1 修复LiquidityPositions组件的时间显示
    - 更新倒计时显示逻辑使用正确的时间单位
    - 确保与质押周期显示一致
    - _需求: 3.2, 3.5_

  - [ ] 4.2 修复EarningsDetail组件的时间显示
    - 更新收益详情中的质押周期显示
    - 保持与其他组件的时间格式一致性
    - _需求: 3.3, 3.4_

  - [ ]* 4.3 编写UI组件一致性的属性测试
    - **属性 1: 时间单位显示一致性**
    - **验证需求: Requirements 1.1, 1.2, 3.1**

- [ ] 5. 实施智能合约时间适配器
  - [ ] 5.1 创建ContractTimeAdapter类
    - 实现天数到秒数的双向转换
    - 添加质押周期验证逻辑
    - _需求: 4.1, 4.2, 4.3_

  - [ ]* 5.2 编写时间转换的属性测试
    - **属性 4: 时间转换双向一致性**
    - **验证需求: Requirements 4.2, 4.3**

- [ ] 6. 检查点 - 验证核心修复
  - 确保所有核心组件显示正确的天数单位，如有问题请询问用户。

- [ ] 7. 实施多语言支持修复
  - [ ] 7.1 更新翻译文件中的时间单位
    - 确保中英文环境下都显示正确的时间单位
    - 修复所有时间相关的翻译文本
    - _需求: 1.5_

  - [ ]* 7.2 编写多语言显示的属性测试
    - **属性 5: 多语言显示一致性**
    - **验证需求: Requirements 1.5, 3.3**

- [ ] 8. 添加组件间一致性验证
  - [ ] 8.1 实施跨组件时间显示验证
    - 确保所有质押相关组件使用统一的时间格式
    - 添加运行时一致性检查
    - _需求: 3.4, 3.5_

  - [ ]* 8.2 编写组件一致性的属性测试
    - **属性 6: 组件间时间显示统一性**
    - **验证需求: Requirements 3.4, 3.5**

- [ ] 9. 实施智能合约集成验证
  - [ ] 9.1 添加前端-合约时间计算验证
    - 确保前端计算的时间参数与合约期望一致
    - 实施时间参数传递的验证逻辑
    - _需求: 4.4_

  - [ ]* 9.2 编写智能合约一致性的属性测试
    - **属性 7: 智能合约时间计算一致性**
    - **验证需求: Requirements 4.1, 4.4**

- [ ] 10. 添加错误处理和降级方案
  - [ ] 10.1 实施时间显示错误处理
    - 添加ConfigurationError和StakingTimeError类
    - 实施错误情况下的降级显示方案
    - _需求: 6.1, 6.2, 6.4_

  - [ ]* 10.2 编写错误处理的单元测试
    - 测试各种错误情况的处理逻辑
    - 验证降级方案的正确性
    - _需求: 6.1, 6.3_

- [ ] 11. 最终检查点 - 全面验证
  - 确保所有测试通过，所有组件显示正确的天数单位，如有问题请询问用户。

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以实现更快的MVP
- 每个任务都引用特定需求以确保可追溯性
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边界情况