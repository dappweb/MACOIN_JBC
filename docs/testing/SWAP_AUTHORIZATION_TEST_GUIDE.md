# Swap授权优化测试指南

## 测试场景

### 1. 首次使用场景
**测试步骤:**
1. 连接钱包（确保有MC或JBC余额）
2. 在Swap页面输入兑换数量
3. 观察授权状态显示

**预期结果:**
- 显示"⚠️ 需要授权 [代币] 代币"状态
- 按钮显示为"授权 [代币] 代币"（黄色）
- 显示授权说明文案

### 2. 授权流程测试
**测试步骤:**
1. 点击"授权 [代币] 代币"按钮
2. 在钱包中确认授权交易
3. 等待授权完成

**预期结果:**
- 按钮显示"授权中..."并有加载动画
- 授权成功后显示"✅ [代币] 代币已授权"
- 按钮变为"确认兑换"（绿色）

### 3. 兑换流程测试
**测试步骤:**
1. 在已授权状态下点击"确认兑换"
2. 在钱包中确认兑换交易
3. 等待交易完成

**预期结果:**
- 直接执行兑换，无需重复授权
- 显示"兑换中..."状态
- 成功后清空输入并刷新余额

### 4. 切换代币测试
**测试步骤:**
1. 在MC→JBC模式下完成授权
2. 点击切换按钮变为JBC→MC模式
3. 输入兑换数量

**预期结果:**
- 切换后重新检查授权状态
- 如果JBC未授权，显示需要授权JBC
- 授权状态正确更新

### 5. 错误处理测试
**测试步骤:**
1. 输入超过余额的数量
2. 在网络不稳定时尝试授权
3. 取消授权交易

**预期结果:**
- 显示"余额不足"错误
- 网络错误时显示相应提示
- 取消交易后状态正确恢复

## 用户体验改进验证

### 优化前 vs 优化后对比

| 场景 | 优化前 | 优化后 |
|------|--------|--------|
| 授权状态 | 隐藏，用户不知道需要授权 | 实时显示，清晰可见 |
| 授权流程 | 在兑换时自动触发，用户困惑 | 独立授权按钮，用户主动操作 |
| 错误提示 | "代币授权不足"，不够友好 | "需要授权代币使用权限"，更清晰 |
| 视觉反馈 | 缺乏状态指示 | 颜色编码：黄色(需授权)、绿色(已授权) |
| 用户引导 | 缺少说明 | 提供授权说明和帮助信息 |

## 技术验证点

### 1. 状态管理
- [ ] `approvalStatus`状态正确更新
- [ ] 切换代币时状态重置
- [ ] 授权完成后状态同步

### 2. 性能优化
- [ ] 避免重复的授权检查
- [ ] 智能的状态缓存
- [ ] 合理的检查频率

### 3. 错误处理
- [ ] 授权失败时的错误提示
- [ ] 网络错误的处理
- [ ] 用户取消操作的处理

## 测试结果记录

**测试环境:**
- 浏览器: 
- 钱包: 
- 网络: 
- 测试时间: 

**测试结果:**
- [ ] 首次使用场景 - 通过/失败
- [ ] 授权流程测试 - 通过/失败  
- [ ] 兑换流程测试 - 通过/失败
- [ ] 切换代币测试 - 通过/失败
- [ ] 错误处理测试 - 通过/失败

**发现的问题:**
1. 
2. 
3. 

**改进建议:**
1. 
2. 
3. 