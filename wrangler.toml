# Cloudflare Pages Configuration - 性能优化版本
# Environment Mapping:
# - production: p-prod branch → jbc-ac-production (jbc.ac domain)
# - preview: test branch → jbc-ac-preview
# Updated: 2025-12-30 - Performance Optimized
#

name = "jbc-ac"
compatibility_date = "2024-01-01"
pages_build_output_dir = "dist"

# 全局优化设置
[build]
command = "npm run build"
cwd = "."
watch_dir = "src"

# 生产环境配置
[env.production]
name = "jbc-ac-production"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[env.production.vars]
ENVIRONMENT = "production"
NODE_ENV = "production"
DAILY_BURN_AMOUNT = "500"
MAX_BURN_AMOUNT = "5000"
BURN_PERCENTAGE = "0.1"
MIN_BALANCE_THRESHOLD = "1000"
# 性能优化变量
CACHE_TTL = "3600"
MAX_CONCURRENT_REQUESTS = "100"
RATE_LIMIT_PER_MINUTE = "1000"
ENABLE_COMPRESSION = "true"
ENABLE_MINIFICATION = "true"

# 预览环境配置
[env.preview]
name = "jbc-ac-preview"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[env.preview.vars]
ENVIRONMENT = "preview"
NODE_ENV = "development"
DAILY_BURN_AMOUNT = "10"
MAX_BURN_AMOUNT = "100"
BURN_PERCENTAGE = "0.01"
MIN_BALANCE_THRESHOLD = "50"
CACHE_TTL = "300"
MAX_CONCURRENT_REQUESTS = "50"
RATE_LIMIT_PER_MINUTE = "500"
ENABLE_COMPRESSION = "true"
ENABLE_MINIFICATION = "false"

# 路由规则优化
[[env.production.routes]]
pattern = "/api/*"
custom_domain = true

[[env.production.routes]]
pattern = "/assets/*"
custom_domain = true

[[env.preview.routes]]
pattern = "/api/*"
custom_domain = false

[[env.preview.routes]]
pattern = "/assets/*"
custom_domain = false

