# 金宝 RWA · DeFi 4.0 智能合约技术需求文档 v2.1

## 一、项目概述
本项目构建一个基于 **双币强通缩模型** 的 DeFi 4.0 收益系统。
*   **MC (主结算代币)**：用于支付门票、提供流动性、结算主要收益。
*   **JBC (价值锚定代币)**：用于承载价值、燃烧通缩、结算部分静态收益。

核心逻辑：通过门票分流、强制流动性锁定、高频销毁（买卖+底池）、动静态混合结算及强制出局机制，实现系统内循环。

---

## 二、核心代币定义

### 2.1 MC (Master Coin)
*   **类型**：原生代币 / ERC20（依链而定）。
*   **不可变性**：不可增发，不可冻结。
*   **用途**：
    1.  购买门票 (100%)。
    2.  提供流动性 (1.5倍门票额)。
    3.  静态收益结算 (50%)。
    4.  动态收益结算 (100%)。
    5.  赎回手续费 (1%)。

### 2.2 JBC (Jinbao Coin)
*   **类型**：ERC20。
*   **总量**：100,000,000 (1亿) 固定，不可增发。
*   **初始价格**：1 MC。
*   **用途**：
    1.  静态收益结算 (50%)。
    2.  AMM 交易对资产。
*   **通缩特性**：
    1.  买入滑点 50%（50% 到用户，50% 销毁）。
    2.  卖出滑点 25%（25% 销毁，75% 兑换）。
    3.  每日底池自动销毁 1%。

---

## 三、门票系统 (Ticket System)

### 3.1 门票档位
用户可购买多张门票，档位固定为：
*   **T1**: 100 MC
*   **T2**: 300 MC
*   **T3**: 500 MC
*   **T4**: 1000 MC

### 3.2 购买与激活 (核心风控)
1.  **购买**：用户支付对应 MC。支持多次购买，门票额度与出局上限自动**累计**。
2.  **状态**：初始状态为 `Pending` (待质押)。
3.  **激活时效**：用户必须在 **72小时** 内完成流动性质押。
    *   **超时处理**：门票自动作废 (Expired)，资金不退。
4.  **流动性要求**：必须质押门票金额 **1.5倍** 的 MC。
    *   例：买 1000 MC 门票，需再质押 1500 MC。

### 3.3 门票资金分配 (Tokenomics)
门票收入 (100% MC) 实时分配如下：
1.  **25% 直推奖励**：直接转给推荐人（需校验推荐人活跃状态）。
2.  **15% 极差/层级奖励**：
    *   进入**奖励池合约**（或按 Pending 记录在合约内）。
    *   按 V1-V9 等级差额计算。
    *   **结算时机**：用户静态收益**到期赎回时**统一结算发放（延迟满足）。
3.  **5% 市场基金**：转至项目方钱包。
4.  **5% 即时回购**：
    *   合约自动调用 DEX 接口（或内部 Swap 逻辑），将 MC 换成 JBC。
    *   换得的 JBC **100% 直接销毁**。
5.  **25% 底池缓冲**：
    *   进入**缓冲合约**（或 LP 注入钱包）。
    *   **执行逻辑**：当缓冲池余额 > 阈值时，通过外部触发（如每笔交易附带或 Keeper）分批买入 JBC 并注入 LP，防止瞬时拉盘。
6.  **25% 国库托底**：转至国库钱包。

---

## 四、流动性与静态收益 (Staking & Yield)

### 4.1 质押规则
*   **前提**：持有有效（未过期）门票。
*   **金额**：门票金额 * 1.5。
*   **周期与收益率**：
    *   **7 天**：日化 2.0%
    *   **15 天**：日化 2.5%
    *   **30 天**：日化 3.0%
*   **锁定**：周期内不可赎回。

### 4.2 收益结算
*   **计算公式**：`收益 = 质押本金 * 日化率 * 周期天数`
*   **发放结构**：
    *   **50% MC**：直接发放。
    *   **50% JBC**：按**当前 AMM 价格**折算为 JBC 发放。

---

## 五、动态收益体系 (Dynamic Rewards)

### 5.1 奖励类型
1.  **直推奖 (25%)**：
    *   来源：门票收入。
    *   发放：购买时秒结。
2.  **极差/层级奖 (15%)**：
    *   来源：门票收入。
    *   规则：V1-V9 级差制。
    *   发放：**下级用户赎回本金时发放**。

### 5.2 等级定义 (V-Levels)
*   **升级条件**：基于**有效直推人数**或**团队总业绩**。
    *   V1: 直推 5 人
    *   ...
    *   V9: 直推 100 人 (示例，需配置化)

### 5.3 烧伤与出局 (Burn & Cap)
1.  **3倍出局**：
    *   单张门票的 `(已领静态 + 已领动态)` >= `门票金额 * 3`。
    *   触发后，该门票状态设为 `EXITED`。
    *   **后果**：该门票对应的本金强制赎回（扣除1%），不再产生静态收益；**该用户不再享受任何动态奖励**（直到购买新门票）。
2.  **烧伤**：
    *   上级门票额度 < 下级门票额度时，动态奖励按上级额度封顶计算。

---

## 六、交易与销毁 (AMM & Burn)

### 6.1 买入 JBC
*   用户支付 MC。
*   **滑点 50%**：
    *   50% JBC -> 用户。
    *   50% JBC -> **黑洞 (0x00...dead)**。

### 6.2 卖出 JBC
*   用户支付 JBC。
*   **滑点 25%**：
    *   25% JBC -> **黑洞**。
    *   75% JBC -> 兑换为 MC 给用户。

### 6.3 底池自动销毁 (Daily Burn)
*   **机制**：每日 00:00 UTC。
*   **操作**：移除 LP 中 **1% 的 JBC 数量**。
*   **去向**：直接销毁。
*   **实现**：`dailyBurn()` 函数，需开放给 Keeper 或任意用户调用（可设置调用奖励以激励执行）。

### 6.4 AMM 机制 (特例)
*   **模式**：协议内撮合 (Protocol Internal AMM)。
*   **流动性管理**：通过 `swapReserveMC` 和 `swapReserveJBC` 管理，不使用外部 Uniswap Pair。
*   **不可撤销**：用户无法添加/移除流动性，仅管理员可通过 `addLiquidity` 注入初始资金。

---

## 七、赎回机制 (Redemption)

1.  **条件**：质押周期结束。
2.  **操作**：用户发起 `redeem()`。
3.  **费用**：扣除 **门票金额 1%** 的 MC 作为手续费。
    *   *注：代码实现中按 (质押本金 * 2/3) * 1% 计算，等效于门票金额 1%。*
4.  **返还**：
    *   退回：100% 质押本金 (MC)。
    *   发放：累计的静态收益 (50% MC + 50% JBC)。
    *   **触发**：结算并释放上级的极差奖励。

---

## 八、安全与权限

1.  **LP 权限**：协议内池子，无 LP Token，无需丢弃权限。
2.  **参数限制**：所有费率（如滑点、日化）需设置硬顶（如不超过 50%），防止管理员恶意修改。
3.  **资金安全**：合约内沉淀的 MC（除国库/市场部分外）属于用户兑付准备金，管理员不可提取。

---

## 九、更新记录 (v2.1)
*   **新增**：多门票累计机制。
*   **新增**：72小时激活时效风控。
*   **新增**：烧伤机制（动态奖励封顶）。
*   **新增**：每日底池销毁 (Daily Burn)。
*   **确认**：AMM 采用协议内撮合模式。
